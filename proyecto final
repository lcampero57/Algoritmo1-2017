// proyecto.cpp : Defines the entry point for the console application.
//
#include "stdafx.h"
#include <iostream>
#include "conio.h"
#include <string>
#include "stdlib.h"

using namespace std;

void alta_directa_c();
void alta_directa_p();
void consulta_directa_p();
/*
void listado_directo(void);
void borrado(void);
*/
void menucliente();
void menuproveedor();

struct t_cliente

{
	int clave_primaria;
	string nombre;
	int edad;
	int UV;
	char descripcion;
	int estado; //borrado logico
	int prec_max;
	int prec_min;
};



struct t_proveedor

{
	int clave_primaria;
	string nombre;
	int UV;
	string ubicacion;
	char descripcion;
	float area;
	int estado; //borrado logico
	int prec;
};

struct t_factura

{



};



 t_cliente registro1;
 FILE *alias1;

 t_proveedor registro2;
 FILE * alias2;

void main()

{int opc;
	do{system("cls");
		cout<<"----------------MENU-------------------"<<endl;
		cout<<"1.-Cliente "<<endl;
		cout<<"2.-Proveedor "<<endl;
		cout<<"0.-Salir "<<endl;
		cout<<"Ingrese la opcion que desea: ";
		cin>>opc;
	
		switch(opc)
		{
		case 1: {//clienteeee
			menucliente();
			break;
				}
		case 2:{
			menuproveedor();
			break;
			   }
		case 0: 
			{cout<<"Gracias por usar el programa"<<endl;break;}
		default:
		{cout<<"error"<<endl;break;}
		break;
		}
	}while(opc<0 || opc>2);
getch();
}
void menucliente()
{int a;
	do{system("cls");
			cout<<"------------Menu Cliente------------"<<endl;
			cout<<" Estas registrau adulau? "<<endl;
			cout<<"1.- Si "<<endl;
			cout<<"2.- No "<<endl;
			cout<<"0.- Salir "<<endl;
			cin.ignore();
			cin>>a;
			
			switch(a)
			{
			{case 1:
			cout<<"Ingrese su clave primaria"<<endl;
			cin>>registro1.clave_primaria;
			cout<<"------------Menu Cliente------------"<<endl;
			cout<<"1.-Historial"<<endl;
			cout<<"2.-Realizar nueva busqueda"<<endl;
			break;
			}
			case 2:
			{system("cls");
			alta_directa_c();
			cout<<"------------Menu Cliente------------"<<endl;
			cout<<"1.-Historial"<<endl;
			cout<<"2.-Realizar nueva busqueda"<<endl;
			break;
			}
			case 0:
				{cout<<"Gracias por usar el programa "<<endl;break;}
			default :
				{cout<< "opcion invalida";break;}
			break;
			}
	}while(a<0 || a>2);
}

void menuproveedor()
{int b,c;
	do{system("cls");
			cout<<"------------Menu Proveedor------------"<<endl;
			cout<<" Estas registrau adulau? "<<endl;
			cout<<"1.- Si "<<endl;
			cout<<"2.- No "<<endl;
			cout<<"0.- Salir "<<endl;
			cin.ignore();
			cin>>b;
			
			switch(b)
			{
			{case 1:
			cout<<"Ingrese su clave primaria"<<endl;
			cin>>registro2.clave_primaria;
			cout<<"------------Menu Proveedor------------"<<endl;
			cout<<"1.-Ingresar nuevo lote"<<endl;
			cout<<"2.-Consulta de lote"<<endl;
			cout<<"3.-Modificar su anuncio"<<endl;
			cout<<"4.-Borrado de su anuncio"<<endl;
			break;
			}
			case 2:
			{system("cls");
			alta_directa_p();
			cout<<"------------Menu Proveedor------------"<<endl;
			cout<<"1.-Ingresar nuevo lote"<<endl;
			cout<<"2.-Consulta de lote"<<endl;
			cout<<"3.-Modificar su anuncio"<<endl;
			cout<<"4.-Borrado de su anuncio"<<endl;
			cin>>c;
			switch(c)
			{case 1: system ("cls"); alta_directa_p();break;
			case 2: system ("cls");consulta_directa_p();break;
			}
			getch();
			
			break;
			}
			case 0:
				{cout<<"Gracias por usar el programa "<<endl;break;}
			default :
				{cout<< "opcion invalida";break;}
			break;
			}
	}while(b<0 || b>2);
}
void alta_directa_c()
{
 int nro_producto, dir_fisica;
     cout<<"INGRESO DE DATOS "<<endl;
     alias1=fopen("PRODUCTO.DIR","rb+");
  if(alias1==NULL)
   fopen("PRODUCTO.DIR","wb+");
  else{
    cout<<"Ingrese su registro para validar si existe: "<<endl;
   cin>>nro_producto;
  dir_fisica=nro_producto*sizeof(registro1);
  fseek(alias1,dir_fisica,SEEK_SET);
  fread(&registro1, sizeof(registro1),1,alias1);
  }
  if(registro1.clave_primaria==nro_producto)
  {cout<<"registro duplicado";
  fclose(alias1);
  return;}
 
  else{
  cout<<"Ingrese registro"<<endl;
  cin>>registro1.clave_primaria;
  cout<<"Ingrese su nombre"<<endl;
  cin.ignore();
  getline(cin,registro1.nombre);
  do{cout<<"Ingrese su edad (+18)"<<endl;
  cin>>registro1.edad;}
  while(registro1.edad<18);
  do{
  cout<<"Ingrese la UV en la que quiere buscar"<<endl;
  cin>>registro1.UV;}while((registro1.UV<0) || (registro1.UV>100));
  do{
  cout<<"Ingrese el tipo de lote que busca; construido(C) o baldio(b)"<<endl;
  cin>>registro1.descripcion;}while((registro1.descripcion!='c') && (registro1.descripcion!='b')); 
  do{
  cout<<"Ingrese precio maximo"<<endl;
  cin>>registro1.prec_max;
  cout<<"Ingrese precio minimo"<<endl;
  cin>>registro1.prec_min;}while((registro1.prec_max>10000000) || (registro1.prec_min<0)); 
  registro1.estado=0;
 
  registro1.clave_primaria==nro_producto;
     fseek(alias1,dir_fisica,SEEK_SET);
  fwrite(&registro1,sizeof(registro1),1,alias1);
  fclose(alias1);
  return;}
}
void alta_directa_p()
{
 int nro_producto, dir_fisica;
     cout<<"INGRESO DATOS "<<endl;
     alias2=fopen("PRODUCTO.DIR","rb+");
  if(alias2==NULL)
   fopen("PRODUCTO.DIR","wb+");
  else{
    cout<<"Ingrese el numero del producto: "<<endl;
   cin>>nro_producto;
  dir_fisica=nro_producto*sizeof(registro2);
  fseek(alias2,dir_fisica,SEEK_SET);
  fread(&registro2, sizeof(registro2),1,alias2);
  }
  if(registro2.clave_primaria==nro_producto)
  {cout<<"registro duplicado"<<endl;
  fclose(alias2);
  return;}
 
  else{
  cout<<"Ingrese registro"<<endl;
  cin>>registro2.clave_primaria;
  cout<<"Ingrese su nombre"<<endl;
  cin.ignore();
  getline(cin,registro2.nombre);
  do{
  cout<<"Ingrese la UV en la que se encuentra su producto"<<endl;
  cin>>registro2.UV;}while(registro2.UV>100);
  do{
  cout<<"Ingrese el tipo de lote que tiene; construido(C) o baldio(B)"<<endl;
  cin>>registro2.descripcion;}while(registro2.descripcion!='c' && registro2.descripcion!='b'); 
  do{
  cout<<"Ingrese su precio (max un millon) "<<endl;
  cin>>registro2.prec;}while(registro2.prec>1000000);
  cout<<"Ingrese su ubicacion"<<endl;
  cin.ignore();
  getline(cin,registro2.ubicacion);
  do{
  cout<<"Ingrese el area del terreno"<<endl;
  cin>>registro2.area;}while(registro2.area<0);
  registro2.estado=0;
  registro2.clave_primaria==nro_producto;
     fseek(alias2,dir_fisica,SEEK_SET);
  fwrite(&registro2,sizeof(registro2),1,alias2);
  fclose(alias2);
  return;}
}
void consulta_directa_p()
{  system("cls"); 
  cout << "\n\rLISTADO DE REGISTROS DE PRODUCTOS"; 
  alias2=fopen("PRODUCTO.SEC","rb"); // Intenta abrir el archivo PRODUCTO.SEC 
                             // en modo de solo lectura 
  if(alias2==NULL) 
  { 
    cout << "\n\n\n\rNo existe el archivo !!!"; 
    cout << "\n\r<<< Oprima cualquier tecla para continuar >>>"; 
    getch(); 
    return; 
  } 
  cout << "\n\rNo Prod                    Descripcion  Cantidad        Precio  Garantia"; 
  cout << "\n\r------------------------------------------------------------------------"; 
  fread(&registro2,sizeof(registro2),1,alias2); 
     // Lee el "Registro", de tamano=sizeof(Registro) del archivo "alias"
  while(!feof(alias2)) // Ciclo mientras no se encuentre el final del archivo 
  { 
printf("\n\r%3d\t%30s\t%3d\t\t$%4.2f\t%c",registro2.UV,registro2.ubicacion,registro2.descripcion,registro2.area,registro2.prec); 
    fread(&registro2,sizeof(registro2),1,alias2); 
  } 
  fclose(alias2); // Cierra el archivo 
  cout << "\n\r------------------------------------------------------------------------"; 
  cout << "\n\rFin del listado !!!"; 
  cout << "\n\r<<< Oprima cualquier tecla para continuar >>>"; 
  getch(); 
  return; 
}
